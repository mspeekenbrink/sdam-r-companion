---
title: "R handout: Computer exercises lecture 1"
author: "Maarten Speekenbrink"
date: "23 September 2016"
output: html_document
---

# Introduction

## What is R?^[This section contains material adapted from https://ourcodingclub.github.io/tutorials/intro-to-r/]

R is a statistical programming language that has rapidly gained popularity in many scientific fields. It was developed by Ross Ihaka and Robert Gentleman as an open source implementation of the "S" programming language. (Next time you need a fun fact, you can say "Did you know that S came before R?") R is also the name of the software that uses this language for statistical computing. With a huge online support community and dedicated packages that provide extra functionality for virtually any application and field of study, there's hardly anything you _can't_ do in R. 

If you already know your way around statistical software like `JASP` or `SPSS`, the main difference is that `R` has no __graphical user interface__, which means there are no buttons to click and no dropdown menus. `R` can be run entirely by typing commands into a text interface (welcome to the Matrix!). This may seem a little daunting, but it also means a whole lot more flexibility, as you are not relying on a pre-determined toolkit for your analyses.

If you need any more convincing, why are we using R and not one of the many other statistical packages like JASP, SPSS, MATLAB, Minitab, or even Microsoft Excel? Well, R is great because:

- R is free and open source, and always will be! Anybody can use the code and see exactly how it works.
- Because R is a programming language rather than a graphical interface, the user can easily save scripts as small text files for use in the future, or share them with collaborators.
- R has a very active and helpful online community - normally a quick search is all it takes to find that somebody has already solved the problem you're having.

## Getting started

### Download R

You can download R from [CRAN (The Comprehensive R Archive Network)](https://cran.r-project.org/). Select the link appropriate for your operating system. 

```{r, echo=FALSE}
knitr::include_url("https://cran.r-project.org/")
```

As you can see, the CRAN website has a rather distinctive "old-school" look. Don't let that fool you though. R itself is anything but old school.

### Download R Studio

R does not come with a graphical interface by default. Most people nowadays interact with R through second-party graphical platforms that provide extra functionality. Probably the most popular graphical front-end to R is __RStudio__. This is actually a full "integrated development environment" (IDE), but mostly, we will use it as a place where we can keep scripts, plots, and R output together in one place.

Like R, RStudio is open source software and free to download for anyone that wants to. You can download RStudio from [the RStudio website](https://rstudio.com/products/rstudio/) (select the free open source desktop version).

```{r, echo=FALSE}
knitr::include_url("https://rstudio.com/products/rstudio/download/#download")
```

<!-- If you are using a Mac, in addition to R and RStudio, you need to download XQuartz ([available here](https://www.xquartz.org/)). -->

## Working with RStudio

`Tools -> Options -> Pane Layout`


## Installing packages

### Installing the `sdam-r` package

The "Statistics: Data analysis and modelling" book has an associated R package which contains the data sets used as examples in the book, as well as some additional functions, and interactive R tutorials. As it is still in quite rapid development as I'm writing, it is not hosted on CRAN yet. That doesn't mean you can't install the package, but it requires a tiny bit more work. 

<!-- Much of this is related to installing packages from source code rather than from pre-compiled binary sources. Linux and Mac OSX versions of R by default come with the ability to install packages from source. On Microsoft Windows, you will need to install some additional software to do this.

#### Installing RTools (Windows only)

```{r}
knitr::include_url("https://cran.r-project.org/bin/windows/Rtools/")
```

-->

```{r, eval=FALSE}
install.packages("remotes")
```

```{r}
remotes::install_github("mspeekenbrink/sdamr")
```

To check whether the package is installed, type 

```{r}
library(sdamr)
````


## Getting help

R may be tricky to master, especially at the start, but help is never far away:

* From within R
    + If you want more information on a specific function, use a question mark before it (e.g., `?plot`) or the `help` function (e.g., `help(plot)`)
    + If you don't know the function name, use two question marks (e.g., `??plot`) or the `help.search` function (e.g., `help.search("plot")`)
    + If you know a function is in a package, use search help on the package (e.g., `?ggplot2`)
* Online
    + The `RSiteSearch("keyword")` function will will search for "keyword" in
all functions available in R, associated packages, and the R-Help News
groups (if desired).
    + R has an active help-list (make sure to read the posting guidelines first; some of the older gang can get a bit grumpy!)
    + The meta-search engine at [www.rseek.org](http://www.rseek.org) is also handy!

## First steps: R as a calculator

R can be used as a console-based calculator. Here are some examples.

```{r}
2 + 11 # addition
2 * 11 # multiplication
2 / 11 # division
2^(11) # exponentiation
sqrt(2) # square root
2^(1/2) # another way to compute the square root
# the order matters!
2 + 11*3
(2 + 11)*3 # R follows the usual rules of arithmetic
```

Note that the hash symbol ("#") is used for comments, such that anything following a "#" is not evaluated. 

## Data

```{r}
library(sdamr)
data("fifa2010teams")
```

```{r}
head(fifa2010teams)
```

```{r}
summary(fifa2010teams)
```

### Data types

#### Numeric

#### Character

#### Logical

#### Factor

#### List

#### Data frame

### Importing data

R can load data in many formats. Personally, I mainly use data stored in "comma separated value" (CSV) format. This is one of the most portable ways of storing data, so that it can be used in a variety of programs like R, SPSS, JASP, Excel, _etc_. 

A nice thing about R is that it can read data directly from the World Wide Web. So you don't need to first download data, and then open it from within R. [TODO: example] 

For R, the latter is actually easier to work with, but you will probably also come across data stored in SPSS format, so it will be useful to work with both formats. To load data in SPSS format, you will need the functionality of an add-on package `foreign`, which needs to be loaded into R first through the `library` function:
```{r}
library(foreign)
```
As the name suggests, the `foreign` package provides tools to work with data in "foreign" formats. To load SPSS data, you can use the function `read.spss`. If you have never used a function before, it is wise to first read the help file for the function. From the console window, you can open the helpfile by typing in a question mark followed by the function name, as in
```{r, eval = FALSE}
?read.spss
```
In the help file, you can see that the first argument of the function is called `file` and it expects a character string with the name of the file, or an URL. Unless you are working from the directory in which the datafile is stored, the name should include the full path (including all directories and subdirectories). On my own computer, I would load in the data as follows:
```{r}
# IQ <- read.spss("../data/IQscores.sav")
IQ <- data.frame(id=1:100,IQ = rnorm(100,mean=100,sd=15))
```
Note that preceding the `read.spss` command, there is a name ("IQ") and a left-pointed arrow. This means I'm assigning the return value of the function to an object named "IQ". In the helpfile, you can see that the return value of the `read.spss` function is "a list (or optionally a data frame)". To see which of these it is, we can use the following function: 
```{r}
is(IQ)
```
which shows it is a list (a list is a special type of vector, which is why you also see "vector" as output of this call. Data frames are the preferred way to deal with data, so we will transform it into a data frame through
```{r}
IQ <- as.data.frame(IQ)
is(IQ)
```
A `data.frame` is a special type of object in R which makes it so useful for data analysis. A `data.frame` builds upon the general list class. Let's have a look at the data.frame by showing the first few rows:
```{r}
head(IQ)
```
The `head` function prints the first 6 rows of a data frame and also the variable names, which here are `id` and `IQ`.  Another useful function to call on a data.frame is
```{r}
summary(IQ)
```
which shows that both variables are numeric, as well as measures such as the mean, etc.

Data in a comma-separated value (CSV) format can be read through the `read.csv` function.

## Computing new variables (e.g., absolute and squared errors)

Compared to SPSS, R makes it quite a bit easier to manipulate data. Suppose that our predicted value of a variable is 80. We can compute the Sum of Absolute Errors as:
```{r}
absError <- abs(IQ$IQ - 80) # compute a new variable called absError
sum(absError) # sum up the values
```
Here, we first computed a new variable (or object) called "absError" which is the absolute error for each observation. On the next line, we compute the sum over all observations.

Computing a new variable can be handy if you want to use it again. However, if you only need the sum of the values once, you can skip computing an intermediate variable. For instance, if we need the sum of squared error when the prediction is 80, we can so this immediately as
```{r}
sum((IQ$IQ - 80)^2)
```
A nice feature is that instead of 80, you can also use the output of a function for your predictions. For instance, if you want to use the mean of the IQ scores as your prediction, you can use e.g.
```{r eval=FALSE}
sum((IQ$IQ - mean(IQ$IQ))^2)
```

## Exploring data: Descriptive statistics

Measures of location and spread can be computed through specialized functions, namely `mean`, `median`, `var` (variance), `sd` (standard deviation), e.g.
```{r, eval=FALSE}
mean(IQ$IQ)
```
will give you the mean of the variable `IQ` in data.frame `IQ`.

Unfortunately, there is no function to compute the mode, so we'll have to write our own. A quick Google search provided the following example, which I have adapted to explicitly deal with the possibility of multiple modes:
```{r}
sdamr_mode <- function(x) {
  ## extract only the unique values in x
  ux <- unique(x)
  ## 
  nx <- tabulate(match(x, ux))
  ## 'max' returns the maximum value of it's argument (e.g. a vector)
  ## 'which' returns the counters of all elements which match its argument
  ## so which == max returns the counters of nx which equal the maximum
  maxid <- which(nx == max(nx))
  ## if there are multiple modes, which returns a vector of length > 1
  ## in that case, there is no single mode and we might as well return
  ## the first one, but with a warning
  if(length(maxid) > 1) {
    warning("There are multiple modes, only the first value is returned, other modes are at: ",paste(ux[maxid[2:length(maxid)]],collapse=", "))
  }
  ux[maxid[1]]
}
```
If you run the code above, you will have defined a new function that you can call like anyu other function. Note that the function name `Mode` is capitalized, as the function `mode` is already defined, but is used to get the "storage mode" of an R object.

## Exploring data: Creating plots

### Plotting a histogram

R has many built-in plotting functions. These tend to be a little basic, and much prettier plots can be made with packages such as `ggplot2` (my current favourite!). But for quick data exploration, the built-in plotting functions are faster. A histogram is plotted through the `hist` function. In the following example, I first generate some random data, store it in an object called `dat` and then plot a histogram:
```{r}
# generate a sample of 100 observations from a Normal distribution with mean=100 and sd=15.
dat <- rnorm(100,mean=100,sd=15)
hist(dat)
```

There are many parameters you can change. In the following, I give the plot a new title and x-axis labels, as well as request the number of bins to be 11:
```{r}
hist(dat,main="Histogram of some random data", xlab="IQ", breaks=11)
```

Unfortunately, specified this way, the number of bins is only a request, and R will determine the number of bins the way the programmers thought its best. To force the number of bins to be exactly 11, we can use the following code:
```{r}
hist(dat,main="Histogram of some random data",xlab="IQ",breaks=seq(min(dat),max(dat),length=11+1))
```

If you look carefully at the code, we now pass to the `breaks` argument the output of a function called `seq` (which stands for sequence). We use the `seq` function here to compute a vector of length: number of bins + 1, which starts at the minimum value in the object `dat` and ends at the maximum value in `dat`. This vector contains the break-points between all the bins in the histogram and looks like this:
```{r}
seq(min(dat),max(dat),length=11+1)
```
As you can see, while R is flexible, it has it's quirks (such as not always giving you what you ask for) and sometimes simple tasks require a bit more work than e.g. SPSS. But hey, how else could you make a (pretty useless!) histogram with 11 randomdly sized bins as in the following?
```{r}
breaks <- c(min(dat),runif(9,min(dat),max(dat)),max(dat))
hist(dat,main="Histogram with random bin size",xlab="Random data",breaks=breaks[order(breaks)],freq=TRUE)
```
